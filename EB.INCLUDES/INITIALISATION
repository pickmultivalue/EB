* @(#) INITIALISATION Ported to jBASE 15:13:20  17 APR 2000
    IF FG$UPDATE THEN         ;! new screen
!
! Initialize screen controlling parameters
!
        FG$FIELD=FG$DEFAULT.DATA;STMP=FG$ACT;MAT SAVE.VARIABLES=''
        MAT DRV.PARAMS='';FG$ACT=STMP;FG$ENQUIRY.ONLY=FG$ENQUIRY.SET
        FG$DEFAULT.DATA=FG$FIELD;FG$FIELD=''
        IF FG$CALL.SCREEN#'' AND NOT(FG$ZOOM) ELSE MAT RECORDS=NULLS;MAT KEYS=''          ;! 12/10/93 split key fix
        IF FG$SCR.NBR.FIELDS#'' THEN FG$FLD=1 ELSE FG$AMEND=TRUE
        FG$PANE=1;FG$CURRENT.PAGE=1:STR(VM:1,COUNT(FG$SCR.FI.PAGE,VM));FG$LAST.PANE=''
        FG$SCREEN.PAGE=1
        FG$ACT.CODE=FALSE
! FG$FILE.NAMES=FG$SCR.FILES;! reset incase field opening required
        IF FG$SCR.FILE.FLDS#'' THEN
            FI=DCOUNT(FG$SCR.FILE.FLDS,VM)
            FOR I=1 TO FI
                FL=FG$SCR.FILE.FLDS<1,I>
                IF FL THEN FG$FILE.NAMES<1,FL>=''
            NEXT I
        END
        IF FG$AMEND ELSE
            FULL.REFRESH=FALSE
            IF INDEX(FG$SCR.DEFAULT.TYPE,'DF',1) THEN CALL EB_DEFAULT
            MAT DAT='';MAT WIN.PANE=''
! any static records to be read ?
            FOR FL=1 TO FG$SCR.NBR.FILES UNTIL FULL.REFRESH
                STMP=FG$SCR.FILE.KEYS<1,FL>
                IF (NOT(NUM(STMP)) AND DCOUNT(STMP,SVM)=1) OR (STMP='' AND KEYS(FL)#'') THEN FULL.REFRESH=TRUE
            NEXT FL
            IF FULL.REFRESH THEN
                CALL EB_DATA.SETUP(FL-1,FULL.REFRESH)
                IF NOT(FG$VALID) THEN FG$FINISHED=TRUE;GOTO FINISH
            END
            IF FULL.REFRESH THEN
                FG$AMEND=TRUE
                FULL.REFRESH=FALSE
                IF FG$REFRESH<2 OR FG$REFRESH=5 THEN FG$REFRESH=10
            END ELSE
                FULL.REFRESH=(FG$CALL.SCREEN='')
                IF NOT(FULL.REFRESH OR FG$POPUP) AND FG$REFRESH=2 THEN FG$REFRESH=1
            END
!
! Is there a SELECT list active ?
!
            IF FG$SELECT.ACTIVE THEN
!
! Assume first key
!
                READNEXT FULL.KEY FROM SELECTS(FG$SELECT.ACTIVE) THEN
                    CALL EB_READNEXT(FULL.KEY)
                END ELSE
!
! If Updating or Aborting and not a control screen...
!============================================
                    IF FG$SCR.CONTROL ELSE FG$FINISHED=TRUE;GOTO FINISH
!============================================
!
! Select list exhausted
!
                    FG$SELECT.LISTS<1,FG$SELECT.ACTIVE>='';FG$SELECT.ACTIVE=FALSE
                END
            END
!
! Any default values ?
!
            IF FG$PASSED.DATA='' AND LEN(FG$DEFAULT.DATA)=COUNT(FG$DEFAULT.DATA,AM) ELSE
                DFLD=FG$FLD
                CALL EB_GET.DFLTS
            END
        END
        FG$FINISHED=FALSE;FG$UPDATE=FALSE;FG$ABORTED=FALSE
        IF FG$CALL.SCREEN#'' AND NOT(FG$ZOOM) THEN FG$CHANGES=FALSE ELSE SUB.CHANGES=FALSE
        FG$INS.PANE=0;ORIG.PANE=1;ORIG.WINDOW=1
! FG$WINDOW=1
    END
!
    IF FG$REFRESH THEN CALL EB_REFRESH
